{"version":3,"file":"wunderbyte.min.js","sources":["../src/wunderbyte.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * WunderByte javascript library/framework\n *\n * @module mod_booking/wunderbyte\n * @package mod_booking\n * @copyright 2023 Kamil Hurajt <info@wunderbyte.at>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport function WunderByteJS() {\n}\n\nWunderByteJS.prototype.sortable = function (opt) {\n    let sortableItems = [];\n    let sortableContainer = null;\n    let draggingItem = null;\n\n    let options = {\n        items: '.wb-item-sortable',\n        container: '.wb-item-container'\n    };\n\n    options = {...options, ...opt};\n\n    this.init = function () {\n        sortableItems = document.querySelectorAll(options.items);\n        sortableContainer = document.querySelector(options.container);\n        sortableItems.forEach(item => {\n            item.setAttribute('draggable', true);\n        });\n        if (sortableContainer) {\n            sortableContainer.addEventListener('dragstart', this.sortable.bind(this));\n        }\n    };\n\n    this.sortable = function (event) {\n        draggingItem = event.target.closest('.list-group-item');\n\n        // Limiting the movement type\n        event.dataTransfer.effectAllowed = 'move';\n        event.dataTransfer.setData('Text', draggingItem.textContent);\n\n        // Subscribing to the events\n        sortableContainer.addEventListener('dragover', this.dragOver.bind(this), false);\n        sortableContainer.addEventListener('dragend', this.dragEnd.bind(this), false);\n\n        setTimeout(function () {\n            draggingItem.classList.add('ghost');\n        }, 0);\n    };\n\n    this.getVerticalCenter = function (element) {\n        let r = element.getBoundingClientRect();\n        return (r.bottom - r.top) / 2;\n    };\n\n    this.getMouseOffset = function (event) {\n        const element = event.target.closest('.list-group-item');\n        let r = element.getBoundingClientRect();\n        return {\n            x: event.pageX - r.left,\n            y: event.pageY - r.top\n        };\n    };\n\n    this.dragOver = function (event) {\n        event.preventDefault();\n        event.dataTransfer.dropEffect = 'move';\n\n        var target = event.target.closest('.list-group-item');\n\n        if (target && target !== draggingItem && target.nodeName == 'LI') {\n            // Sorting\n\n            const offset = this.getMouseOffset(event);\n            const middleY = this.getVerticalCenter(target);\n\n            if (offset.y > middleY && target.nextSibling) {\n                sortableContainer.insertBefore(draggingItem, target.nextSibling);\n            } else if (target && target.className.indexOf(options.item) !== -1) {\n                sortableContainer.insertBefore(draggingItem, target);\n            }\n        }\n    };\n\n    this.dragEnd = function (event) {\n        event.preventDefault();\n        if (draggingItem) {\n            draggingItem.classList.remove('ghost');\n            sortableContainer.removeEventListener('dragover', this.dragOver, false);\n            sortableContainer.removeEventListener('dragend', this.dragEnd, false);\n\n            draggingItem = null;\n        }\n    };\n\n    this.init();\n};\n\nWunderByteJS.prototype.dragable = function (opt) {\n    let options = {\n        container: '.wb-droppable',\n        items: '.wb-item-draggable'\n    };\n\n    let draggingItem = null;\n\n    options = {...options, ...opt};\n\n    this.init = function () {\n        var items = document.querySelectorAll(options.items);\n\n        // make items draggable\n        items.forEach(item => {\n            item.setAttribute('draggable', true);\n            item.addEventListener('dragstart', this.dragStart.bind(this));\n            item.addEventListener('dragend', this.dragEnd.bind(this));\n        });\n\n        var containers = document.querySelectorAll(options.container);\n\n        // make containers listen to drop events\n        containers.forEach(container => {\n            container.classList.add('wb-droppable');\n\n            container.addEventListener('dragenter', this.dragEnter.bind(this));\n            container.addEventListener('dragover', this.dragOver.bind(this));\n            container.addEventListener('drop', this.dragDrop.bind(this));\n        });\n    };\n\n    this.dragStart = function () {\n        setTimeout(() => this.classList.add('hidden'), 0);\n        draggingItem = this;\n    };\n\n    this.dragEnd = function () {\n        this.classList.remove('hidden');\n        draggingItem = null;\n    };\n\n    this.dragDrop = function () {\n        this.append(draggingItem);\n    };\n\n    this.dragEnter = function (e) {\n        e.preventDefault();\n    };\n\n    this.dragOver = function (e) {\n        e.preventDefault();\n    };\n\n    return this.init();\n};\n"],"names":["WunderByteJS","prototype","sortable","opt","sortableItems","sortableContainer","draggingItem","options","items","container","init","document","querySelectorAll","querySelector","forEach","item","setAttribute","addEventListener","this","bind","event","target","closest","dataTransfer","effectAllowed","setData","textContent","dragOver","dragEnd","setTimeout","classList","add","getVerticalCenter","element","r","getBoundingClientRect","bottom","top","getMouseOffset","x","pageX","left","y","pageY","preventDefault","dropEffect","nodeName","offset","middleY","nextSibling","insertBefore","className","indexOf","remove","removeEventListener","dragable","_this","dragStart","dragEnter","dragDrop","_this2","append","e"],"mappings":";;;;;;;;cAwBgBA,2GAGhBA,aAAaC,UAAUC,SAAW,SAAUC,SACpCC,cAAgB,GAChBC,kBAAoB,KACpBC,aAAe,KAEfC,QAAU,CACVC,MAAO,oBACPC,UAAW,sBAGfF,uCAAcA,SAAYJ,UAErBO,KAAO,WACRN,cAAgBO,SAASC,iBAAiBL,QAAQC,OAClDH,kBAAoBM,SAASE,cAAcN,QAAQE,WACnDL,cAAcU,SAAQ,SAAAC,MAClBA,KAAKC,aAAa,aAAa,MAE/BX,mBACAA,kBAAkBY,iBAAiB,YAAaC,KAAKhB,SAASiB,KAAKD,aAItEhB,SAAW,SAAUkB,OACtBd,aAAec,MAAMC,OAAOC,QAAQ,oBAGpCF,MAAMG,aAAaC,cAAgB,OACnCJ,MAAMG,aAAaE,QAAQ,OAAQnB,aAAaoB,aAGhDrB,kBAAkBY,iBAAiB,WAAYC,KAAKS,SAASR,KAAKD,OAAO,GACzEb,kBAAkBY,iBAAiB,UAAWC,KAAKU,QAAQT,KAAKD,OAAO,GAEvEW,YAAW,WACPvB,aAAawB,UAAUC,IAAI,WAC5B,SAGFC,kBAAoB,SAAUC,aAC3BC,EAAID,QAAQE,+BACRD,EAAEE,OAASF,EAAEG,KAAO,QAG3BC,eAAiB,SAAUlB,WAExBc,EADYd,MAAMC,OAAOC,QAAQ,oBACrBa,8BACT,CACHI,EAAGnB,MAAMoB,MAAQN,EAAEO,KACnBC,EAAGtB,MAAMuB,MAAQT,EAAEG,WAItBV,SAAW,SAAUP,OACtBA,MAAMwB,iBACNxB,MAAMG,aAAasB,WAAa,WAE5BxB,OAASD,MAAMC,OAAOC,QAAQ,uBAE9BD,QAAUA,SAAWf,cAAmC,MAAnBe,OAAOyB,SAAkB,KAGxDC,OAAS7B,KAAKoB,eAAelB,OAC7B4B,QAAU9B,KAAKc,kBAAkBX,QAEnC0B,OAAOL,EAAIM,SAAW3B,OAAO4B,YAC7B5C,kBAAkB6C,aAAa5C,aAAce,OAAO4B,aAC7C5B,SAAsD,IAA5CA,OAAO8B,UAAUC,QAAQ7C,QAAQQ,OAClDV,kBAAkB6C,aAAa5C,aAAce,eAKpDO,QAAU,SAAUR,OACrBA,MAAMwB,iBACFtC,eACAA,aAAawB,UAAUuB,OAAO,SAC9BhD,kBAAkBiD,oBAAoB,WAAYpC,KAAKS,UAAU,GACjEtB,kBAAkBiD,oBAAoB,UAAWpC,KAAKU,SAAS,GAE/DtB,aAAe,YAIlBI,QAGTV,aAAaC,UAAUsD,SAAW,SAAUpD,SACpCI,QAAU,CACVE,UAAW,gBACXD,MAAO,sBAGPF,aAAe,YAEnBC,uCAAcA,SAAYJ,UAErBO,KAAO,0BACIC,SAASC,iBAAiBL,QAAQC,OAGxCM,SAAQ,SAAAC,MACVA,KAAKC,aAAa,aAAa,GAC/BD,KAAKE,iBAAiB,YAAauC,MAAKC,UAAUtC,KAAKqC,QACvDzC,KAAKE,iBAAiB,UAAWuC,MAAK5B,QAAQT,KAAKqC,WAGtC7C,SAASC,iBAAiBL,QAAQE,WAGxCK,SAAQ,SAAAL,WACfA,UAAUqB,UAAUC,IAAI,gBAExBtB,UAAUQ,iBAAiB,YAAauC,MAAKE,UAAUvC,KAAKqC,QAC5D/C,UAAUQ,iBAAiB,WAAYuC,MAAK7B,SAASR,KAAKqC,QAC1D/C,UAAUQ,iBAAiB,OAAQuC,MAAKG,SAASxC,KAAKqC,iBAIzDC,UAAY,2BACb5B,YAAW,kBAAM+B,OAAK9B,UAAUC,IAAI,YAAW,GAC/CzB,aAAeY,WAGdU,QAAU,gBACNE,UAAUuB,OAAO,UACtB/C,aAAe,WAGdqD,SAAW,gBACPE,OAAOvD,oBAGXoD,UAAY,SAAUI,GACvBA,EAAElB,uBAGDjB,SAAW,SAAUmC,GACtBA,EAAElB,kBAGC1B,KAAKR"}